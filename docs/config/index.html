<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.21-DEV" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Config &middot; Funnel</title>
  

  
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/poole.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/monokai-sublime.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/syntax.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/theme.css">
  <link rel="stylesheet" href="https://ohsu-comp-bio.github.io/funnel/css/funnel.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ohsu-comp-bio.github.io/funnel/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://ohsu-comp-bio.github.io/funnel/favicon.png">

  <script src="https://ohsu-comp-bio.github.io/funnel/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

  <div class="global-header">
    <div class="global-header-container">
      <div class="global-header-home">
        <a href="https://ohsu-comp-bio.github.io/funnel/"><h1>Funnel</h1></a>
      </div>
      <ul class="global-header-nav">
          <li><a href="https://ohsu-comp-bio.github.io/funnel/install/">Install</a></li>
          <li><a href="https://ohsu-comp-bio.github.io/funnel/docs/">Docs</a></li>
          <li><a href="https://github.com/ohsu-comp-bio/funnel">GitHub</a></li>
          <li><a href="https://gitter.im/ohsu-comp-bio/funnel">Chat</a></li>
        </ul>
      <div class="global-header-ohsucb">
        <a href="https://www.ohsu.edu/xd/education/schools/school-of-medicine/departments/computational-biology/"><h2>OHSU Comp. Bio.</h2></a>
      </div>
    </div>
  </div>


<div class="content section group">

  <div class="sidebar col span_3_of_12">
    <ul class="sidebar-nav">
      
      
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/"
          class="sidebar-nav-item "
          >Overview</a></li>
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/install/"
          class="sidebar-nav-item "
          >Install</a></li>
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/quickstart/"
          class="sidebar-nav-item "
          >Quickstart</a></li>
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/config/"
          class="sidebar-nav-item  active"
          >Config</a></li>
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/guides/"
          class="sidebar-nav-item "
          >Guides</a></li>
          
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/aws/"
                   class="sidebar-nav-item "
                >AWS Deployment</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/google-cloud/"
                   class="sidebar-nav-item "
                >Google Cloud Deployment</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/htcondor/"
                   class="sidebar-nav-item "
                >HTCondor</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/grid-engine/"
                   class="sidebar-nav-item "
                >Open Grid Engine</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/pbs-torque/"
                   class="sidebar-nav-item "
                >PBS/Torque</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/slurm/"
                   class="sidebar-nav-item "
                >SLURM</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/openstack/"
                   class="sidebar-nav-item "
                >OpenStack</a></li>
            </ul>
          </li>
          
          <li>
            <ul class="sidebar-nav sidebar-nav-nested">
              <li>
                <a href="https://ohsu-comp-bio.github.io/funnel/docs/guides/basic-auth/"
                   class="sidebar-nav-item "
                >Basic Auth</a></li>
            </ul>
          </li>
          
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/development/"
          class="sidebar-nav-item "
          >Development</a></li>
          
        
        <li><a
          href="https://ohsu-comp-bio.github.io/funnel/docs/design/"
          class="sidebar-nav-item "
          >Design</a></li>
          
        
        <li><a
          href="https://godoc.org/github.com/ohsu-comp-bio/funnel"
          class="sidebar-nav-item "
          >Reference</a></li>
          
        
      
    </ul>
  </div>

  <div class="main col span_8_of_12">
    

<h1 id="configuration">Configuration</h1>

<p>Usage:</p>

<pre><code class="language-shell">$ funnel --config funnel.config.yaml [server | worker | ... ]
</code></pre>

<p>Below is a YAML config file containing all the possible options and default values.<br />
(Note: the config is still a mess, but we&rsquo;re working on improving it)</p>

<pre><code class="language-YAML">Server:
  # Hostname of the Funnel server. Mainly, this is used by auto-scalers
  # to configure workers.
  HostName: localhost

  # Port used for HTTP communication and the web dashboard.
  HTTPPort: 8000

  # Port used for RPC communication.
  RPCPort: 9090

  # Require basic authentication for the server APIs using a password.
  # If used, make sure to properly restrict access to the config file
  # (e.g. chmod 600 funnel.config.yml)
  # Password: abc123

  # Include a &#34;Cache-Control: no-store&#34; HTTP header in Get/List responses
  # to prevent caching by intermediary services.
  DisableHTTPCache: true

  # Limit the size of task executor logs (stdout/err), in bytes.
  MaxExecutorLogSize: 10000 # 10 KB

  # The name of the active server database backend
  # Available backends: boltdb, dynamodb
  Database: boltdb
  Databases:
    BoltDB:
      # Path to the database file
      Path: ./funnel-work-dir/funnel.db

    # DynamoDB:
    #   # Basename to use for dynamodb tables
    #   TableBasename: &#34;funnel&#34;
    #   # AWS region
    #   Region: &#34;&#34;
    #   Credentials:
    #     # AWS Access key ID
    #     Key: &#34;&#34;
    #     # AWS Secret Access Key
    #     Secret: &#34;&#34;

    Elastic:
      # Prefix to use for indexes (task, events, nodes)
      IndexPrefix: &#34;funnel&#34;
      # URL of the elasticsearch server.
      URL: http://localhost:9200

  Logger:
    # Logging levels: debug, info, error
    Level: info
    # Write logs to this path. If empty, logs are written to stderr.
    OutputFile: &#34;&#34;

# The scheduler is used for the GCE, Openstack, and Manual compute backends. 
Scheduler:
  # How often to run a scheduler iteration.
  # In nanoseconds.
  ScheduleRate: 1000000000 # 1 second
  # How many tasks to schedule in one iteration.
  ScheduleChunk: 10
  # How long to wait between updates before marking a node dead.
  # In nanoseconds.
  NodePingTimeout: 60000000000 # 1 minute
  # How long to wait for a node to start, before marking the node dead.
  # In nanoseconds.
  NodeInitTimeout: 300000000000 # 5 minutes
  Node:
    # If empty, a node ID will be automatically generated.
    ID: &#34;&#34;

    # Files created during processing will be written in this directory.
    WorkDir: ./funnel-work-dir
    # If the node has been idle for longer than the timeout, it will shut down.
    # -1 means there is no timeout. 0 means timeout immediately after the first task.
    Timeout: -1

    # A Node will automatically try to detect what resources are available to it. 
    # Defining Resources in the Node configuration overrides this behavior.
    Resources:
      # CPUs available.
      # Cpus: 0

      # RAM available, in GB.
      # RamGb: 0.0

      # Disk space available, in GB.
      # DiskGb: 0.0

      # For low-level tuning.
      # How often to sync with the Funnel server.
      # In nanoseconds.
      UpdateRate: 5000000000 # 5 seconds
      # RPC timeout for update/sync call.
      # In nanoseconds.
      UpdateTimeout: 1000000000 # 1 second

      Logger:
        # Logging levels: debug, info, error
        Level: info
        # Write logs to this path. If empty, logs are written to stderr.
        OutputFile: &#34;&#34;


# The name of the active compute backend
# Available backends: local, htcondor, slurm, pbs, gridengine, manual, gce, openstack, aws-batch
Backend: local

# Scheduler backend config
Backends:
  HTCondor:
    Template: |
      universe = vanilla
      getenv = True
      executable = {{.Executable}}
      arguments = worker run --config {{.Config}} --task-id {{.TaskId}}
      log = {{.WorkDir}}/condor-event-log
      error = {{.WorkDir}}/funnel-stderr
      output = {{.WorkDir}}/funnel-stdout
      should_transfer_files = YES
      when_to_transfer_output = ON_EXIT_OR_EVICT
      {{if ne .Cpus 0 -}}
      {{printf &#34;request_cpus = %d&#34; .Cpus}}
      {{- end}}
      {{if ne .RamGb 0.0 -}}
      {{printf &#34;request_memory = %.0f GB&#34; .RamGb}}
      {{- end}}
      {{if ne .DiskGb 0.0 -}}
      {{printf &#34;request_disk = %.0f GB&#34; .DiskGb}}
      {{- end}}

      queue

  PBS:
    Template: |
      #!bin/bash
      #PBS -N {{.NodeId}}
      #PBS -o {{.WorkDir}}/funnel-stdout
      #PBS -e {{.WorkDir}}/funnel-stderr
      {{if ne .Cpus 0 -}}
      {{printf &#34;#PBS -l nodes=1:ppn=%d&#34; .Cpus}}
      {{- end}}
      {{if ne .RamGb 0.0 -}}
      {{printf &#34;#PBS -l mem=%.0fgb&#34; .RamGb}}
      {{- end}}
      {{if ne .DiskGb 0.0 -}}
      {{printf &#34;#PBS -l file=%.0fgb&#34; .DiskGb}}
      {{- end}}

      {{.Executable}} worker run --config {{.Config}} --task-id {{.TaskId}}

  GridEngine:
    Template: |
      #!bin/bash
      #$ -N {{.NodeId}}
      #$ -o {{.WorkDir}}/funnel-stdout
      #$ -e {{.WorkDir}}/funnel-stderr
      #$ -l nodes=1
      {{if ne .Cpus 0 -}}
      {{printf &#34;#$ -pe mpi %d&#34; .Cpus}}
      {{- end}}
      {{if ne .RamGb 0.0 -}}
      {{printf &#34;#$ -l h_vmem=%.0fG&#34; .RamGb}}
      {{- end}}
      {{if ne .DiskGb 0.0 -}}
      {{printf &#34;#$ -l h_fsize=%.0fG&#34; .DiskGb}}
      {{- end}}

      {{.Executable}} worker run --config {{.Config}} --task-id {{.TaskId}}
  
  SLURM:
    Template: |
      #!/bin/bash
      #SBATCH --job-name {{.NodeId}}
      #SBATCH --ntasks 1
      #SBATCH --error {{.WorkDir}}/funnel-stderr
      #SBATCH --output {{.WorkDir}}/funnel-stdout
      {{if ne .Cpus 0 -}}
      {{printf &#34;#SBATCH --cpus-per-task %d&#34; .Cpus}}
      {{- end}}
      {{if ne .RamGb 0.0 -}}
      {{printf &#34;#SBATCH --mem %.0fGB&#34; .RamGb}}
      {{- end}}
      {{if ne .DiskGb 0.0 -}}
      {{printf &#34;#SBATCH --tmp %.0fGB&#34; .DiskGb}}
      {{- end}}

      {{.Executable}} worker run --config {{.Config}} --task-id {{.TaskId}}

  GCE:
    # Path to account credentials file.
    # If possible, this will be automatically discovered.
    AccountFile: &#34;&#34;
    # Google Cloud project ID.
    # If possible, this will be automatically discovered.
    Project: &#34;&#34;
    # Google Cloud zone.
    # If possible, this will be automatically discovered.
    Zone: &#34;&#34;
    Weights:
      # Prefer nodes that start up quickly.
      # Nodes that are already online have instant startup time.
      PreferQuickStartup: 1.0
    # How long to cache GCE API results (machine list, templates, etc)
    # before refreshing.
    CacheTTL: 60000000000 # 1 minute

  # Batch describes the configuration for the AWS Batch compute backend.
  Batch:
    # JobDefinition can be either a name or the Amazon Resource Name (ARN).
    JobDefinition: &#34;funnel-job-def&#34;
    # JobQueue can be either a name or the Amazon Resource Name (ARN).
    JobQueue: &#34;funnel-job-queue&#34;
    # AWS region of the specified job queue and to create the job definition in
    Region: &#34;&#34;
    Credentials:
      Key: &#34;&#34;
      Secret: &#34;&#34;


Worker:
  # Files created during processing will be written in this directory.
  WorkDir: ./funnel-work-dir

  # File storage systems.
  #
  # This is usually set automatically by the scheduler, but you might need this
  # if you&#39;re starting a worker manually.
  Storage:
    # Local file system.
    Local:
      # Whitelist of local directory paths which Funnel is allowed to access.
      AllowedDirs:
        - ./

    # S3:
    #   Credentials:
    #       # AWS Access key ID
    #       Key: &#34;&#34;
    #       # AWS Secret Access Key
    #       Secret: &#34;&#34;

    # GS:
    #     # Path to account credentials file.
    #     # Optional. If possible, credentials will be automatically discovered
    #     # from the environment.
    #   - AccountFile:
    #     # Automatically discover credentials from the environment.
    #     FromEnv: true

    # Swift:
    #   UserName:
    #   Password:
    #   AuthURL:
    #   TenantName:
    #   TenantID:
    #   RegionName:

  # For low-level tuning.
  # How often to send task log updates to the Funnel server.
  # In nanoseconds.
  UpdateRate: 5000000000 # 5 seconds

  # Maximum task log (stdout/err) size, in bytes to buffer between updates.
  BufferSize: 10000 # 10 KB

  # The name of the active task reader backend.
  # Available backends: rpc, dynamodb
  TaskReader: rpc
  TaskReaders:
    # Read tasks directly from DynamoDB.  
    # DynamoDB:
    #   # Basename to use for dynamodb tables
    #   TableBasename: &#34;funnel&#34;
    #   # AWS region
    #   Region: &#34;&#34;
    #   Credentials:
    #     # AWS Access key ID
    #     Key: &#34;&#34;
    #     # AWS Secret Access Key
    #     Secret: &#34;&#34;

  # The name of the active event writer backend.
  # Available backends: rpc, log, dynamodb
  ActiveEventWriters: 
    - rpc
    - log
  EventWriters:
    # Write events over gRPC
    RPC:
      # RPC timeout for update/sync call.
      # In nanoseconds.
      UpdateTimeout: 1000000000 # 1 second

    # Translate events and store their content in DynamoDB.
    # DynamoDB:
    #   # Basename to use for dynamodb tables
    #   TableBasename: &#34;funnel&#34;
    #   # AWS region
    #   Region: &#34;&#34;
    #   Credentials:
    #     # AWS Access key ID
    #     Key: &#34;&#34;
    #     # AWS Secret Access Key
    #     Secret: &#34;&#34;

  Logger:
    # Logging levels: debug, info, error
    Level: info
    # Write logs to this path. If empty, logs are written to stderr.
    OutputFile: &#34;&#34;


</code></pre>

  </div>

</div>
</body>
</html>
